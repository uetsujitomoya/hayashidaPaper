%本章では，システム開発にあたり必要となるカウンセリングの基礎事項について説明する．心理療法では，単一ですべてに
%通じる学派はない．最大の学派は認知行動療法と言われているが，今回提案システムの使用データとして取り扱うヨーガ療法ではアドラー心理学が取り入れられている．

%アドラー心理学は認知行動
%療法の先駆け的存在とされている．行っていることは認知の修正で，同じようなアプローチがとられている．
%アドラー心理学はオーストリアの精神科医であるアルフレッド・アドラー (A.Adler)が創始し，その後継者たちが発展させた心理学の理論，思想と治療技法の体系である\cite{zokad}．17世紀にルネ・デカルトが端を発して以来，1879年にヴィルヘルム・ヴントが世界初の心理学実験室を創設したことで哲学的ルーツから切り離された．ジョン・B・ワトソンが「人間の行動――学習されたか否かを問わず，人間の行動や発話の総体――をその主題とする，自然科学の一部門」と述べて以来，アメリカで行動主義が心理学の有力手法となった一方で，実験的証拠よりも観察と症例に基礎を置いたジグムント・フロイトの考えがヨーロッパを中心に広がっていった．フロイトの考えに初めは賛成していたカール・ユングとアルフレート・アドラーは，後にフロイトの考えに異を唱えた．%カール・ユングが唱えたのは，人間誰しも，個人的経験には一切基づいていないあるはっきりと分離された無意識の部分，つまり「集合的無意識」が存在し，「集合的無意識」は神話や象徴として世代を超えて代々受け継がてきた「元型（アーキタイプ）」から成り立っているということであった．

%%一方，アドラーが初めて示唆したのは，個人の心理は現時点における意識的諸力にも影響されるが，社会的領域や環境の影響も同様に見逃せないということであった．




%%世間では，「嫌われる勇気」が大ベストセラーになったおかげで，昨年から急に有名となってきましたが，マイナーな学派であった．ヨーガ療法についても同様である．


%ヴントの心理学は実験心理学で，臨床心理学とは長年相容れないものとして存在し続けてきた．現在でも，実験系の心理と臨床系の心理は，なかなかディスカッションが進まない状態も残存している．そこに認知行動療法が出てきて，実験系と臨床系がかなり相乗りするようになってきたのが現代までの大まかな流れだとされている．

%精神分析もアドラー心理学もユング心理学も旧世代の心理学といわれているが，ア
%ドラー心理学のみは，認知療法の前の論理療法のエリスがアドラー心理学を学ん
%でおり，アドラー心理学のコンセプトをかなり取り入れた経緯がある．そこ
%から認知療法が発展してきているので，認知療法の先駆けとしてのアド
%ラー心理学があるということにされている．





%現在，世界保健機関（WHO）憲章前文において「健康とは，病気でないとか，弱っていないということではなく，肉体的にも，精神的にも，そして社会的にも，すべてが
%満たされた状態にあることをいいます．（日本WHO協会訳）」と書いてある通り，WHOは健康を肉体的・精神的・社会的という3つの側面からとらえている．一方，アドラーは「人生のすべての問題は，3つの主要なタスクに分類することが出来る．つまり，交友のタスク，仕事のタスク，愛のタスクであると唱えた\cite{ad2}．以上からアドラー心理学では，ライフタスクについて，来談者にとっての親疎の関係から，
%\begin{itemize}
%\item 仕事のタスク：永続しない人間関係
%\item 交友のタスク：永続するが，運命をともにしない人間関係
%\item 愛のタスク：永続し，運命をともにする人間関係
%\end{itemize}
%の3つに区別している．臨床上，人間の問題についてこのように恣意的に3つに分類することは，極めて有効であるとされている．

%


本章では,クライエントの発言内容のカテゴリ分類の手法について詳しく述べる.なお本研究では,会話の流れの可視化システムと同様にクライエントの発言内容を1文毎に分類している.クライエントの1文とは,句点かクエスチョンマークで区切られた単位のことである.また,クライエントの発言内容は上でも述べたように「愛」「交友」「仕事」という3つのカテゴリに分類する.

\section{分類手法の概要}

本研究における分類手法の概要を図3.1に示す.
まず,Yahoo!知恵袋\cite{yahoo}の悩み相談に関する文章をコーパスとして,word2vecを用いて,単語のベクトルを得る.word2vecにより得た単語のベクトルを基に,3つのどのカテゴリに属しているかのラベルを持ったYahoo!知恵袋の悩み相談に関する文のベクトルを教師付きデータとする.同様の手順で,クライエントの発言内容を書き起こしたテキストデータを1文毎にベクトル化し,これに正解カテゴリを付与したものをテストデータとする.教師付きデータを機械学習の入力データとし,学習させて,テストデータを学習したモデルに入力し,出力された予測カテゴリと予め与えられている正解ラベルとが一致するか調べ評価を行う.
3.2節から3.5節にかけて本研究での分類における各段階の詳細について述べる.

\section{word2vecを用いた単語のベクトル化}

本研究で扱うデータは様々な単語から構成される文章の集まった文書データである.しかしコンピュータで単語や文を扱うために,単語や文を数値ベクトルとして表現する必要がある.機械学習により自動でテキストデータの分類を行う研究はこれまでに様々行われてきたが,多くの機械学習のアルゴリズムでは入力の次元数を学習前に定める必要がある.扱うテキストデータは単語の数,文や文章の長さがそれぞれ異なるものがほとんどであり,入力するテキストデータを固定長のベクトルで表現する必要がある.このような課題に対してこれまでに主に用いられている手法はbag-of-wordsである.bag-of-wordsは文章を単語の集合として捉え,単語の並び方などは考慮せずに,単語の出現の有無と出現回数のみを考慮する手法である.しかしこの手法を用いると,学習に用いるテキストデータに含まれる語彙数だけベクトルの次元数が増えてしまい,語彙数と次元数が等しくなる.そのためニューラルネットワークなどのネットワークを用いた機械学習での入力次元が数万〜数十万程度の次元になり,学習を行う際に計算時間が膨大になる.このような次元数の大きいベクトルに対して特異値分解による次元圧縮を行い,それを用いた分類\cite{ShortText}も行われているが,数千次元まで圧縮すると分類精度が落ちることが報告されている.そこで,単語の分散表現を学習することで単語を数百次元程度の低次元のベクトルで表現する手法であるword2vecがMikolovら\cite{pylearn}により提案された.bag-of-wordsのようにベクトルの1つの次元のみが値を持ち,その他の次元の値が0となる疎なベクトル表現とは違い,分散表現では全ての次元が値を持っている.本研究においても機械学習を行う際に扱うテキストデータには数万以上の語彙数が含まれているためword2vecを用いて単語のベクトル化を行った.

word2vecに学習させるコーパスとしてはWikipediaやニュース記事のような大規模データが用いられることが多い.そこから得られた単語の分散表現を用いて機械学習などを用いて分類を行う研究では,分類の対象となるのがニュース記事などであることが多いためである.しかし本研究で扱うテキストデータはカウンセリングデータであり会話文である.Wikipediaやニュース記事は,固有名詞が比較的多く出現するが,個人の感情を表す形容詞はあまり含まれていない.しかしカウンセリングデータは会話文であるため固有名詞は少なく,感情を表す形容詞は比較的多く含まれる.しかし,カウンセリングの内容を書き起こしたテキストデータはあまり多く存在しておらず,且つプライベートな内容であるためインターネットなどでは公開されておらず,収集するのが困難である.そこで,カウンセリングデータとより似た内容の文章をコーパスに用いることを考えた.そのためカウンセリングデータに比較的内容が近いと思われるYahoo!知恵袋に投稿されたものの中で悩み相談に関するカテゴリから文章を取得した.具体的には,本研究で分類を行う「愛」「交友」「仕事」の3カテゴリと内容が類似していると思われる以下の4カテゴリから取得した. 4カテゴリの中から,1つの質問とそれに対してのベストアンサーを1件として,各カテゴリ12000件,計48000件を取得してコーパスとした.
\begin{itemize}
\item 愛：　「恋愛相談」,「家族関係の悩み」
\item 交友：　「友人関係の悩み」
\item 仕事：　「職場の悩み」
\end{itemize}

また,word2vecは元々英語の文章を対象に考えられているため,コーパスは単語同士が半角スペースで区切られている必要がある.そのため,本研究では形態素解析ツールMeCab14)を用いて予め知恵袋の文章を単語毎に区切った文章を入力した.また,コーパスに対して形態素解析を行う際に,全ての単語を基本形で出力している.

次にword2vecで学習を行う際のパラメータについて述べる.ベクトルの次元数に関して,word2vecの開発者であるMikolovらによると,コーパスのデータサイズが増えるにつれてベクトルの次元数も大きくすべきとされている15).また,データサイズがあまり大きくないにも関わらずベクトルの次元数を大きくしすぎると,精度が落ちることも報告されている.デフォルトの次元数は100次元であり,本研究で用いたコーパスはデータサイズがおよそ40MB,語彙数がおよそ1万語と大きくないため,ベクトルの次元数は200以下とした.窓長は各窓長に対して学習後の各単語の意味的な類似度を調べた際に適切な値とされる5に設定した.学習アルゴリズムとしてcbowモデルかSkip-gramモデルを選択できるが,本研究ではSkip-gramモデルを選択した.また,min-countの値は5とし,コーパス内に5回未満しか出現しない単語は考慮しないとした.このような手順で単語の分散表現を得た.

\section{文のベクトル化} 

次に3.2節で述べた単語の分散表現を用いて,文をベクトルに変換する.word2vecにより単語の分散表現を得た際と同様にして,まず文を単語毎に区切る必要がある.そして文中に出現する各単語のベクトルをword2vecにより得た分散表現から見つけ出し,それを用いて文ベクトル化を行う.具体例として,「母ともよく喧嘩しますし.」という文ベクトル化の流れを図3.2に示す.
\begin{itemize}
\item 「母ともよく喧嘩しますし.」という文に対して形態素解析により単語毎の分かち書きを行い,基本形で出力する.
\item 文中に出現する全ての単語に対して,各単語のベクトルをword2vecにより学習したモデルから取り出す.ただし文末の句点とクエスチョンマークは除いた.
\item 「母」,「とも」,「よく」,「喧嘩」,「する」,「ます」,「し」の単語ベクトルの1次元目の値を全て足し合わせ,各単語のベクトルの1次元目の和を計算する.このとき,もし単語がword2vecにより学習したモデルに存在せずベクトルが存在しなかった場合,その単語は無視する.
\item 1次元目に対して行った手順をベクトルの次元全てに対して行い,全ての次元分の和を計算する
\item 各文の長さは異なり,また単語の数も異なるので,足し合わせた単語数で各次元の和を割り,これを文のベクトルとする
\end{itemize}
つまり,各単語と文ベクトルの次元数をMとして,文ベクトルを

\begin{eqnarray*}
  && d=[d_1,d_2,d_3,?,d_M ]  
\end{eqnarray*}

 %                          (1)
とし,足し合わせた単語の,i番目の単語のj次元目の要素の値を\begin{eqnarray*}w_ij\end{eqnarray*}とすると,

\begin{eqnarray*}
  && d_1=\frac{1}{N}\sum_{i=1}^n w_i1, d_2=\frac{1}{N}\sum_{i=1}^n w_i2,?,d_M=\frac{1}{N}\sum_{i=1}^n w_iM
\end{eqnarray*}



と表せる.Xingら10)は,機械学習による文書分類を行う際に,word2vecで得た単語ベクトルの単純な和の平均として文章ベクトルを作成する手法により,分類精度が高くなることを示している.したがって本研究でも,文ベクトルを単語ベクトルの和の平均として算出した.

\section{文ベクトルを入力とする機械学習}

本節では,本研究における学習と分類手法について述べる.本研究の目的は,予め指定された3つの「愛」「交友」「仕事」カテゴリに,どのカテゴリに属するかが未知である文を正確に自動カテゴリ分類することである.本研究で行う学習は教師付き学習であり,教師付き学習とは,入力のデータに対して出力が指定されて学習を行う方法である.本研究では,3.3節で述べた手順で算出した1文毎の文ベクトルを,入力である1文毎の特徴量として用いて,出力には「愛」「交友」「仕事」の3つの分類カテゴリを用いる.学習を行ったパターン認識器に対して,どのカテゴリに属するか未知であるクライエントの発言1文毎の文ベクトルを入力し,予測カテゴリを出力させることで,自動カテゴリ分類を行う.

本研究では,機械学習に用いるアルゴリズムにSVM16)とニューラルネットワーク17)を用いた.

SVMとはパターン認識モデルの1つであり,線形しきい素子を用いて2つのカテゴリのパターン識別機を構成する手法である.2つのカテゴリに分類を行う際に,ハードマージンSVMでは入力データが完全に線形分離可能であると仮定して,1つの誤分類も許容せずに分離超平面を決定する.つまり,M個のm次元教師付きデータxi(i=1, 2,…, M)がクラス1, 2いずれかに属するとして,ラベルをクラス1のときにyi=1, クラス2のときに-1とする.線形分離可能である場合,決定関数はwをm次元係数ベクトル,bはバイアス項として
\begin{eqnarray*}
  && D(x)=w^T x+b 
\end{eqnarray*}                      % (3)
と決めることが出来る.また線形分離の条件から決定関数は

\begin{eqnarray*}
  && y_i (w^T x_i+b)?1      (i=1,?,M )   
\end{eqnarray*}                     %       (4)
の条件を満たす.条件式(4)を満たすようなw,bを求め,入力データに対して分離超平面を決定するが,このとき分離超平面とそれにもっとも近い教師データとの間の距離をマージンとよぶ.条件式(4)を満たす分離超平面は無数に存在するが,SVMではマージンが最大となる超平面を識別境界とする.したがって,SVMでは汎化能力が高いというのが大きな特徴である.

しかし,本研究では入力データは完全に線形分離可能ではないと考え,ソフトマージンSVMを用いた.ソフトマージンSVMでは線形分離可能でない場合に適用できるように,\begin{eqnarray*}\xi_i (?0)\end{eqnarray*}を導入し条件式(4)を拡張し,
\begin{eqnarray*}
  && y_i (w^T x_i+b)?1-\xi_i,      (i=1,?,M)   
\end{eqnarray*}     %                (5)
を満たし,
\begin{eqnarray*}
  && Q(w,b,\xi)=\frac{1}{2} ‖w‖^2+C\sum{i=1}^M \xi_i 
\end{eqnarray*} %　　　　             (6)
を最小にするような最適化問題を考え分離超平面を決定する.したがってハードマージンSVMとは異なり,ソフトマージンSVMでは誤分類を許容する.ここでCは式(6)の右辺第1項のマージン最大化と第2項の誤分類の最小化のトレードオフを決定するパラメータであり,分離超平面の決定に大きな影響を与えるため,適切に設定する必要がある.
　そして,このように入力空間内で非線形分離を行う必要がある場合には入力空間を高次元の特徴空間に写像して特徴空間上でマージンが最大となるように超平面を決定する方式がよく用いられており,カーネル法とよばれているが,本研究でもこの方式を用いた.カーネル法では,非負のラグランジュ乗数\begin{eqnarray*}\alpha_i,\beta_i\end{eqnarray*}を導入して,決定関数は
\begin{eqnarray*}
  && D(x)=\sum{i∈S} \alpha_i y_i K(x_i,x_j)+b
\end{eqnarray*}%                         (7)
となる.ここで\begin{eqnarray*}K(x_i,x_j)\end{eqnarray*}はカーネルであり,問題に応じてこのカーネルを適切に選ぶことで汎化能力を向上することができる.本研究では,
\begin{eqnarray*}
  && K(x,x')=x^T x' 
\end{eqnarray*}%                        (8)
で表される線形カーネル(linear)と,
\begin{eqnarray*}
  && K(x,x')=exp(-\gamma‖x-x' ‖^2 )
\end{eqnarray*}　　　　(9)
で表されるラジアル基底関数カーネル(rbf)を用いた.ここでγは分布の半径を制御するパラメータであり,rbfカーネルにおいて超平面の決定に大きな影響を与える.

また,上でも述べたようにSVMは2つのカテゴリに分類する2値分類を基本としているが,本研究では3つのカテゴリに分類することを目的としている.SVMにおいて多カテゴリへの分類を行う場合,One-Vs-One方式とOne-Vs-The-Rest方式のいずれかを用いる.今,Kカテゴリに分類することを考える.One-Vs-One方式はある特定のカテゴリに属するか,また別の特定のカテゴリに属するかの2カテゴリ分類問題を解く分類器を,全てのカテゴリの組み合わせ,つまりK(K-1)/2個使用する.One-Vs-The-Rest方式はある特定のカテゴリに属するか,他のK-1個のいずれかのカテゴリに属するかの2カテゴリ分類問題を解く分類器を,全ての組み合わせ,K個利用する.

ニューラルネットワークもパターン認識に用いられるモデルの1つである.本研究で用いたニューラルネットワークは入力層と出力層を1つずつ持ち,中間層を複数持つ多層ニューラルネットワークである.また全てのノード同士がリンクによって繋がれた,全連結型のネットワークである.ニューラルネットワークの仕組みの概要として,入力層の各ノードに値を入力し,それぞれの値が重みを持ったノード間のリンクを通って,閾値を持った中間層の各ノードに受け渡され,その値が中間層で変換される.中間層で変換される際には活性化関数を用いて変換が行われる.そして変換された値が同じように次の中間層へと受け渡されていき,最後に出力層に伝達し値を出力させる.そして出力した値が期待される値に近づくように,各ノード間のリンクの重みやノードの閾値を最適化するように学習を行う.

つまり,本研究では入力層のノード数を各文ベクトルの次元数と等しく固定し,ベクトルの各要素の値を入力層の各ノードに入力する.出力層のノード数は分類カテゴリ数と同じ3で固定し,出力が最も大きいカテゴリをその文が属するカテゴリであると判断する.また中間層の層数,ノード数は可変なパラメータとしており,このパラメータによって精度が変わるため,SVMと同様に後述の実験により最適なパラメータを求めた.

本研究での分類の手順としては,初めに3.3節で作成した教師付きデータを上で述べた機械学習の入力として学習を行う.そして学習後のモデルにテストデータを入力し,「愛」「交友」「仕事」のいずれかの予測カテゴリを出力させ3カテゴリへの分類を行う.

















%





%理論的な特徴として，
%\begin{itemize}
% \item 人間を分割できない全体として把握し，理性と感情・意識と無意識などの対立を認めないこと
% \item 客観事実よりも，客観事実に対する個人の主観的認知のシステムを重視すること
% \item 精神内界よりも個人とその相手役との対人関係を理解しようとすること
%\end{itemize}
%などが挙げられる．
%思想的な特徴としては，
%\begin{itemize}
% \item 他者を支配しないで生きる決心をすること
% \item 他者に関心を持って相手を援助しようとすること
% \item 他者を支配しないで生きる決心をすること
% \item 他者に関心を持って相手を援助しようとすること
%\end{itemize}
%などが挙げられる．
%治療技法としては，
%\begin{itemize}
% \item 現実的に達成可能な治療目標の一致をとること
% \item 来談者，つまり来談者の言うことの主として目的について推量をして，それを来談者に確認をとること
% \item 来談者自身が自分の責任で解決しなければならないタスクと，来談者には責任がなく介入する権利がないタスクとを区別すること
% \item 目標達成のためのさまざまなアイディアを提供すること
%\end{itemize}
%などが挙げられる．

%アドラー心理学は，社会精神医学・自我心理学・人間学的心理学などの現代の心理学諸潮流の理論的先駆けであるといわれている．（以上，日本アドラー心理学会Webページより）

%アドラー心理学に基づいた治療，または，カウンセリングでは，アドラー心理学の理論に基づいて，来談者の共同体感覚を育成する目的で，様々な技法が用いられる．そのような治療中，または，カウンセリング中に，治療者，または，治療者が，常に，意識しているのは，来談者のライフスタイルについてである．
%アドラー心理学では，人間の問題は，すべて対人関係上の問題であると考える．したがって，アドラー心理学の治療，または，カウンセリングにおいては，来談者が抱えている問題は，対人関係上の問題であり，来談者が自らの使える力をうまく工夫すれば解決できるライフタスクであると考えている．



%臨床心理士資格取得者数は年を経るごとに増加傾向にあるが，新人治療者は，上記のような「対人関係上の問題」つまり「愛のタスク」・「仕事のタスク」・「交友のタスク」を，質問に対する回答として来談者から引き出すのに苦戦しているという問題がある．

%そこで，熟練治療者が新人治療者に指導する機会が設けられている．たとえば今回書き起こしテキストデータを使用した「心療内科における摂食障害専門ヨーガ療法グループ」事例検討会では，新人治療者に対してカウンセリングに関するアドバイスがなされている．





%%治療者の質問内容については，大きく2種類に分けられている．YesまたはNoで答える質問，または短い言葉だけで答えられるような質問は「閉じられた質問」または「閉ざされた質問」と呼ばれている．これに対し，来談者が5W1H「いつ」「どこで」「誰が」「何を」「どのように」「どうした」で答えるような質問は「開かれた質問」と呼ばれている．来談者が何に問題意識を感じているかをカウンセリングで引き出すには，治療者は「閉じられた質問」よりも「開かれた質問」をしたほうがよいとされている．しかし新人治療者は「閉じられた質問」の割合が多く，来談者が何に問題意識を感じているかをカウンセリングでうまく引き出せないケースが比較的多いとされている．

%来談者の会話としては，内容がどのタスク領域（仕事，交友，愛，セルフタスク，スピリチュアル）に属するのか，治療者の質問としては，内容がオープン（5W1Hを問うもの）またはクローズ（Yes/Noを問うもの）なのかを分類表示できることが必要である．


%もうひとつのタスクとして，新人治療者は閉じられた質問を多く用いる傾向にあるので，新人治療者を開かれた質問が自由に使えるようになる必要がある．これをチェックできることが求められる．

以上の分類法をもとに，本研究では，時間軸に沿った可視化によって，来談者と治療者の会話の流れを可視化し，治療者の発した質問によって会話の流れがどのように変化するのかを明らかにするWebシステムを開発した．次章では本論文の提案システムに対する要件の抽出，および設計と実装について説明する．
